<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" xmlns="http://www.w3.org/1999/html">
<head>
    <script type="text/javascript" src="/js/jquery-1.8.3.min.js"></script>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
    <!-- 图片文本框 -->
    <form id="searchForm">
        <div style="text-align: center;">
            被访对象姓名：<input type="text" name="visitedname" id="visitedname"></br>
            被访对象手机号码：<input type="text" name="visitedpnum" id="visitedpnum"></br>
            来访事由：<input type="text" name="visitedevent" id="visitedevent"></br>
            来访时间：<input type="text" name="visittime" id="visittime"></br>
            离开时间：<input type="text" name="lefttime" id="lefttime"> </br>
            来访者姓名：<input type="text" name="visitorname" id="visitorname"></br>
            来访者手机号码：<input type="text" name="visitorpnum" id="visitorpnum"></br>
            身份证号：<input type="text" name="identitynum" id="identitynum"></br>
            车牌号：<input type="text" name="platenum" id="platenum"></br>
            <input type="file" class="form-control" id="file" name="file" th:onchange="|javascript:preview(this)|"></br>
            <!-- 这个是在上传之前回显图片图片展示 -->
            <div id="preview">
                　　<!--这个是为了将页面返回的图片展示出来的.默认隐藏-->
                　　<img style="width: 100px; height: 100px;display:none" id="imgHidden" />
            </div></br>

            <!-- 提交...这里pageIndex和pageSize可传可不传,主要取决于提交之后是否需要回到当前页面. -->
            <button type="button" th:onclick="|javascript:submitForm()|" class="btn btn-primary">提交</button>
        </div>
    </form>

    <script>
        let tmp1;//数据文件存这里
        function submitForm() {
            debugger;
            let formData = new FormData(); //将需要提交的参数封装起来
            let visitinfo = {};
            visitinfo["visitedname"] = $("#visitedname").val();
            visitinfo["visitedpnum"] = $("#visitedpnum").val();
            visitinfo["visitedevent"] = $("#visitedevent").val();
            visitinfo["visittime"] = $("#visittime").val();
            visitinfo["lefttime"] = $("#lefttime").val();
            visitinfo["visitorname"] = $("#visitorname").val();
            visitinfo["visitorpnum"] = $("#visitorpnum").val();
            visitinfo["identitynum"] = $("#identitynum").val();
            visitinfo["platenum"] = $("#platenum").val();
            visitinfo["file"] = tmp1;
            visitinfo = JSON.stringify(visitinfo);

            formData.append("visitinfo",visitinfo)
            $.ajax({
                url : '/uploadinfo',
                type : 'post',
                data : formData,
                processData : false,
                contentType : false,
                success : function(value) {
                    let result = JSON.parse(value);
                    if (result == 'true') {
                        Lobibox.alert('success', {msg : "信息上传成功!!!"});
                    } else {
                        Lobibox.alert('error', {msg : "信息上传失败!!!"});
                    }
                }
            });
        }
        //图片回显:
        function preview(file) {
            debugger;
            $("#imgHidden").css("display", "none");
            let prevDiv = document.getElementById('preview');
            if (file.files && file.files[0]) {
                let reader = new FileReader();
                reader.onload = function(evt) {
                    debugger;
                    prevDiv.innerHTML = '<img style="width: 100px;height: 100px;" src="' + evt.target.result + '" />';
                    tmp1 = evt.target.result;
                }
                reader.readAsDataURL(file.files[0]);
            } else {
                prevDiv.innerHTML = '<div class="img" style="width: 100px;height:100px;filter:progid:DXImageTransform.Microsoft.AlphaImageLoader(sizingMethod=scale,src=\'' +
                    file.value + '\'"></div>';
            }
        }
    </script>
</body>
</html>